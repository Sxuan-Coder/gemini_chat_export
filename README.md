# Google Gemini 聊天记录导出器

🚀 一键导出 Google Gemini 网页端的聊天对话记录，支持多种格式（TXT/JSON/Markdown）

## ✨ 主要功能

- **自动滚动导出**：智能滚动整个聊天界面，完整捕获所有对话记录
- **Canvas 内容导出**：单独导出代码块、文档等 Canvas 内容
- **组合导出功能**：一键同时导出聊天对话和 Canvas 内容
- **多格式支持**：支持 TXT、JSON、Markdown 三种导出格式
- **可视化格式选择**：新增可视化格式选择器，无需控制台操作
- **智能内容识别**：自动识别用户提问、AI 思维链和回答内容
- **智能去重功能**：自动去除重复的对话内容，确保导出数据干净
- **断点续传**：支持手动停止滚动，随时中断导出过程
- **现代化界面**：右侧折叠式 UI 面板，美观且不影响正常使用

## 🛠️ 安装方法

1. 安装浏览器扩展管理器（如 [Tampermonkey](https://www.tampermonkey.net/)）
2. 复制 `gemini_chat_export.js` 脚本内容
3. 在 Tampermonkey 中创建新脚本并粘贴代码
4. 保存并启用脚本

## 📖 使用教程

### 基础使用

1. 打开 [Google Gemini](https://gemini.google.com/app) 聊天页面
2. 在页面右侧会看到一个 **"<"** 折叠按钮
3. 点击折叠按钮打开导出面板
4. 选择需要的导出格式（TXT/JSON/MD）
5. 选择导出功能：
   - **滚动导出对话**：导出完整的聊天记录
   - **导出 Canvas**：导出代码块和文档内容
   - **一键导出对话+Canvas**：同时导出聊天记录和 Canvas 内容
6. 脚本会自动处理并下载相应文件

### 高级功能

#### 导出格式选择

在右侧面板中直接点击格式选择器即可切换导出格式：

- **📄 TXT**：纯文本格式
- **📊 JSON**：结构化数据格式
- **📝 MD**：Markdown 格式

#### 导出功能说明

**1. 滚动导出对话**

- 自动滚动整个聊天界面
- 智能识别用户问题、AI 思维链和回答
- 支持断点续传和手动停止

**2. 导出 Canvas**

- 提取页面中的代码块
- 提取响应内容中的文档和文本
- 自动去重，避免重复内容

**3. 一键导出对话+Canvas**

- 组合以上两种功能
- 一次性获取完整的对话和 Canvas 内容
- 数据格式统一，便于后续处理

#### 格式说明

- **TXT 格式**：结构清晰的文本格式，包含分隔线，易于阅读
- **JSON 格式**：标准 JSON 数组，格式为 `[{role, content, id}]`
- **Markdown 格式**：支持折叠显示思维链，适合文档展示

### 操作技巧

- **打开/关闭面板**：点击右侧的 **"<"** 或 **">"** 按钮切换面板显示
- **停止滚动**：导出过程中可点击 **"停止滚动"** 按钮中断
- **格式实时切换**：可在导出前随时切换格式，无需重新加载页面
- **最佳实践**：建议在开始导出前手动滚动到对话顶部，确保完整性

## 📁 导出文件命名

文件命名格式因导出类型而异：

- **滚动导出**：`项目名_scroll_时间戳.扩展名`
- **Canvas 导出**：`项目名_Canvas_export_时间戳.扩展名`
- **组合导出**：`项目名_Combined_时间戳.扩展名`

例如：

- `Gemini_编程问题讨论_scroll_20250909_143022.txt`
- `Gemini_代码示例_Canvas_export_20250909_143045.json`
- `Gemini_完整对话_Combined_20250909_143102.md`

## ⚙️ 配置参数

可在脚本中调整以下参数来优化导出效果：

```javascript
const SCROLL_DELAY_MS = 1000; // 滚动间隔时间（毫秒）
const MAX_SCROLL_ATTEMPTS = 300; // 最大滚动次数
const SCROLL_INCREMENT_FACTOR = 0.85; // 滚动增量因子
```

## 🔧 故障排除

### 常见问题

**Q: 导出的内容不完整怎么办？**
A: 尝试增加 `SCROLL_DELAY_MS` 的值，给页面更多加载时间

**Q: 脚本按钮不显示？**
A: 确认已正确安装 Tampermonkey 并启用脚本，刷新页面重试

**Q: 滚动卡住不动？**
A: 点击"停止滚动"按钮，然后重新尝试导出

**Q: 遇到 TrustedHTML 错误？**
A: 当前版本（v1.0.5）已修复此问题，请更新到最新版本

**Q: 导出的内容出现重复怎么办？**
A: v1.0.5 版本已经修复了所有格式的重复导出问题，包括：

- 组合导出时消息重复的问题
- TXT 和 MD 格式用户输入重复的问题
- Canvas 内容重复提取的问题
  如果仍遇到重复，请确认使用的是最新版本

**Q: JSON 格式正常但 TXT/MD 格式有问题？**
A: 这是 v1.0.4 及更早版本的已知问题，v1.0.5 已统一所有格式的去重逻辑

### 技术支持

如果遇到页面结构更新导致的兼容性问题，可能需要：

1. 检查浏览器控制台的错误信息
2. 更新脚本中的 CSS 选择器
3. 调整滚动参数以适应新的页面结构

## 📄 许可证

本项目基于 Apache 2.0 许可证开源, 您可以在遵守许可证条款的前提下自由使用、修改和分发本项目的代码。

开源地址：[https://github.com/Sxuan-Coder/gemini_chat_export](https://github.com/Sxuan-Coder/gemini_chat_export)

## 🎯 版本信息

当前版本：v1.0.5

### v1.0.5 更新内容

- 🐛 **重大修复**：彻底解决了组合导出功能中消息被重复导出两次的问题
- 🐛 **格式修复**：修复滚动导出和组合导出在 TXT 和 MD 格式时用户输入内容重复的问题
- ⚡ **性能优化**：改进了 Canvas 内容提取的去重算法，避免重复内容
- 🔧 **代码优化**：统一了不同导出格式的去重逻辑，确保一致性
- 📊 **数据准确性**：修复了导出数据索引计算错误，确保去重后索引连续性
- 🎯 **用户体验**：JSON 格式导出已保持正常（无重复），现在所有格式都能正常工作

### 历史版本

- v1.0.4: 修复了兼容性问题，删除 SDK 导出功能
- v1.0.3: 优化滚动逻辑
- v1.0.2: 增加多格式支持
- v1.0.1: 基础滚动导出功能

---

💡 **提示**：首次使用建议先在测试对话中尝试，确保导出效果符合预期后再用于重要对话的备份。
